# Vulnerability Report: CVE-2024-43788

**Date Identified**: 2025-11-18
**Severity**: HIGH (CVSS 6.4/10)
**Status**: ⚠️ UNPATCHED
**Alert**: GitHub Dependabot #117

---

## Summary

The project uses **webpack 5.91.0**, which is vulnerable to **CVE-2024-43788**, a Cross-Site Scripting (XSS) vulnerability via DOM Clobbering in the `AutoPublicPathRuntimeModule` class.

---

## Vulnerability Details

### CVE-2024-43788 - Cross-Site Scripting (XSS) via DOM Clobbering

**Affected Package**: `webpack`
**Current Version**: `5.91.0`
**Vulnerable Versions**: 5.91.0, 5.92.0, 5.92.1, 5.93.0
**Fixed Version**: `5.94.0`
**Published**: August 2024
**CVSS Score**: 6.4 (Medium-High)

### Description

Webpack's `AutoPublicPathRuntimeModule` contains a DOM Clobbering vulnerability that can lead to Cross-Site Scripting (XSS) attacks in web pages where:

1. Attacker-controlled HTML elements are present (e.g., `<img>` tag with unsanitized `name` attribute)
2. JavaScript code compiled by Webpack is executed
3. The DOM Clobbering gadget manipulates the `publicPath` determination

### Technical Details

**Vulnerable Code Path**: `AutoPublicPathRuntimeModule` in webpack core

**Attack Vector**:
```html
<!-- Attacker injects malicious HTML -->
<img name="currentScript" id="malicious">
<script src="webpack-bundle.js"></script>
```

When webpack's runtime code tries to determine the public path using `document.currentScript`, the DOM clobbering attack can redirect it to attacker-controlled values, leading to XSS.

### Real-World Exploitation

This vulnerability has been **actively exploited in the wild**, notably in:
- **Canvas LMS**: XSS attacks through webpack-compiled JavaScript
- Other education and enterprise platforms using webpack

---

## Impact Assessment

### For AWS Profile Containers Extension

**Risk Level**: **MEDIUM-LOW**

#### Why Not Critical for This Project?

1. **Browser Extension Context**:
   - Extension runs in isolated context (not a public website)
   - Content Security Policy (CSP) prevents inline scripts
   - No user-generated HTML in extension pages

2. **Limited Attack Surface**:
   - Popup and settings pages use React (escaped by default)
   - No direct DOM manipulation with user input
   - Cloudscape components sanitize inputs

3. **Mitigating Factors**:
   ```json
   // manifest.json
   "content_security_policy": {
     "extension_pages": "script-src 'self'; object-src 'self'"
   }
   ```
   - CSP prevents execution of injected scripts
   - Only extension scripts can run

#### Potential Attack Scenarios (Low Probability)

**Scenario 1: Compromised API Server**
1. Malicious API server returns crafted profile names
2. Profile name contains DOM clobbering payload
3. React renders profile (escaped by default)
4. ❌ **Blocked by**: React's XSS protection + CSP

**Scenario 2: Extension Vulnerability Chain**
1. Attacker exploits different vulnerability to inject HTML
2. Injected HTML contains DOM clobbering elements
3. Webpack runtime executes with clobbered globals
4. ❌ **Blocked by**: CSP prevents script execution

**Scenario 3: Development Environment**
1. Developer runs malicious test case
2. Test injects DOM clobbering payload
3. Webpack bundle executes with clobbered DOM
4. ✅ **Possible**: Dev environment less restricted

### Why Still Important to Fix

Despite low exploitation probability:

1. **Defense in Depth**: Remove unnecessary attack vectors
2. **Dependency Hygiene**: Keep dependencies updated
3. **Supply Chain Security**: Prevent future transitive exploits
4. **Compliance**: Meet security scanning requirements
5. **Best Practice**: Stay current with security patches

---

## Additional Vulnerabilities Found

### 1. CVE-2025-50181 - Boto3 (Medium Severity)

**Affected Package**: `boto3` (via `urllib3` transitive dependency)
**Current Version**: `>=1.40.0` (likely affected)
**Issue**: SSRF via redirect policy bypass
**Fix**: Upgrade `urllib3` to `>=2.5.0` or `boto3` to latest

**Impact for This Project**: LOW
- Boto3 only used in API server (not exposed to untrusted input)
- All boto3 calls go to AWS official endpoints
- No user-controlled URLs passed to boto3

**Recommendation**: Upgrade as part of routine maintenance

---

### 2. CVE-2024-24762 - FastAPI (Medium Severity)

**Affected Package**: `fastapi` (via `python-multipart`)
**Current Version**: `>=0.121.0` (need to verify exact version)
**Issue**: ReDoS via Content-Type header parsing
**Fix**: Upgrade to latest FastAPI with patched multipart dependency

**Impact for This Project**: LOW
- API server on localhost only (not internet-facing)
- Extension is only client (controlled environment)
- Rate limiting mitigates DoS attempts

**Recommendation**: Upgrade as part of routine maintenance

---

## Remediation

### Priority: HIGH (Despite Low Exploitation Risk)

**Recommended Actions**:

1. **Immediate**: Upgrade webpack to `5.94.0` or later
2. **Short-term**: Review all dependencies for known CVEs
3. **Medium-term**: Implement automated dependency scanning (Dependabot, Snyk)
4. **Long-term**: Regular dependency update schedule (monthly)

### Fix Implementation

#### Update package.json

**Current**:
```json
"webpack": "^5.91.0"
```

**Updated**:
```json
"webpack": "^5.95.0"
```

**Commands**:
```bash
# Update webpack
npm install webpack@latest --save-dev

# Verify fix
npm audit

# Test build
npm run build

# Test dev mode
npm run dev
```

#### Verification Steps

1. **Check version**:
   ```bash
   npm list webpack
   # Should show: webpack@5.95.0 or later
   ```

2. **Run security audit**:
   ```bash
   npm audit
   # Should show: found 0 vulnerabilities
   ```

3. **Test functionality**:
   - Build extension: `npm run build`
   - Run dev mode: `npm run dev`
   - Test in Firefox: `npm run start:firefox`
   - Verify all features work (popup, settings, profile loading)

4. **Regression testing**:
   ```bash
   npm test
   # All tests should pass
   ```

---

## Prevention Measures

### 1. Automated Dependency Scanning

**Enable Dependabot** (already enabled):
```yaml
# .github/dependabot.yml
version: 2
updates:
  - package-ecosystem: "npm"
    directory: "/"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10

  - package-ecosystem: "pip"
    directory: "/api-server"
    schedule:
      interval: "weekly"
    open-pull-requests-limit: 10
```

### 2. Pre-commit Hooks

**Add security checks to Husky**:
```json
// package.json
"husky": {
  "hooks": {
    "pre-commit": "npm audit --audit-level=high && npm run lint"
  }
}
```

### 3. CI/CD Security Scanning

**GitHub Actions workflow**:
```yaml
# .github/workflows/security.yml
name: Security Scan

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  schedule:
    - cron: '0 0 * * 0'  # Weekly

jobs:
  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Run npm audit
        run: npm audit --audit-level=high

      - name: Run Snyk
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
```

### 4. Dependency Update Policy

**Recommendations**:
- **Critical/High**: Patch within 7 days
- **Medium**: Patch within 30 days
- **Low**: Patch with next release
- **Dev dependencies**: Review quarterly

### 5. Version Pinning Strategy

**Current approach** (caret ranges):
```json
"webpack": "^5.91.0"  // Allows 5.x.x updates
```

**Consider exact pinning for critical deps**:
```json
"webpack": "5.95.0"  // Exact version only
```

**Pros/Cons**:
- ✅ Exact: Predictable builds, no surprise breakage
- ❌ Exact: Manual updates required, miss security patches
- ✅ Caret: Automatic patch updates
- ❌ Caret: Potential breaking changes

**Recommendation**: Use caret with Dependabot alerts

---

## References

### CVE-2024-43788
- **NVD**: https://nvd.nist.gov/vuln/detail/CVE-2024-43788
- **Snyk**: https://security.snyk.io/vuln/SNYK-JS-WEBPACK-7840298
- **OSV**: https://osv.dev/vulnerability/CVE-2024-43788
- **GitHub Advisory**: https://github.com/webpack/webpack/security/advisories

### CVE-2025-50181 (Boto3)
- **Details**: https://mtools.sasshoes.com/blog/boto3-vulnerability-cve-2025-50181

### CVE-2024-24762 (FastAPI)
- **Snyk**: https://security.snyk.io/vuln/SNYK-PYTHON-FASTAPI-6228055

### Tools
- **npm audit**: https://docs.npmjs.com/cli/v10/commands/npm-audit
- **Snyk**: https://snyk.io/
- **Dependabot**: https://github.com/dependabot

---

## Timeline

| Date | Event |
|------|-------|
| 2024-08-XX | CVE-2024-43788 published |
| 2024-08-XX | Webpack 5.94.0 released with fix |
| 2024-XX-XX | GitHub Dependabot creates alert #117 |
| 2025-11-18 | Vulnerability identified during security review |
| 2025-11-18 | Fix planned (upgrade to webpack 5.95.0) |

---

## Approval & Sign-off

**Reviewed by**: Security Audit
**Date**: 2025-11-18
**Recommended Action**: Upgrade webpack to 5.95.0+
**Priority**: HIGH (preventive measure)
**Risk if not fixed**: LOW (mitigated by CSP and extension context)
**Risk if fixed**: LOW (well-tested webpack upgrade path)

---

**Next Steps**: See remediation section above for implementation guide.
